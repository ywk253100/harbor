import { Component, OnInit, Input } from '@angular/core';
import {
    ScanningResultService,
    VulnerabilityItem
} from '../service/index';
import { ErrorHandler } from '../error-handler/index';

import { toPromise } from '../utils';
import { GRID_COMPONENT_HTML } from './scanning.html';
import { SCANNING_STYLES } from './scanning.css';

@Component({
    selector: 'hbr-vulnerabilities-grid',
    styles: [SCANNING_STYLES],
    template: GRID_COMPONENT_HTML
})
export class ResultGridComponent implements OnInit {
    scanningResults: VulnerabilityItem[] = [];
    @Input() tagId: string;

    constructor(
        private scanningService: ScanningResultService,
        private errorHandler: ErrorHandler
    ) { }

    ngOnInit(): void {
        this.loadResults(this.tagId);
    }

    showDetail(result: VulnerabilityItem): void {
        console.log(result.id);
    }

    loadResults(tagId: string): void {
        toPromise<VulnerabilityItem[]>(this.scanningService.getVulnerabilityScanningResults(tagId))
            .then((results: VulnerabilityItem[]) => {
                this.scanningResults = results;
            })
            .catch(error => { this.errorHandler.error(error) })
    }

    filterVulnerabilities(terms: string): void {
        console.log(terms);
    }

    refresh(): void {
        this.loadResults(this.tagId);
    }
}
